<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>calendar</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="asset/css/style.css" type="text/css">
</head>


{{{body}}}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

  // This is our API key
  var APIKey = "40cae4c09ea811068014399388bb357e";

  // Here we are building the URL we need to query the database
  var queryURL =
    "https://api.openweathermap.org/data/2.5/forecast?q=Dallas,US&units=imperial&appid=" +
    APIKey;

  // Here we run our AJAX call to the OpenWeatherMap API
  $.ajax({
    url: queryURL,
    method: "GET"
  })
    // We store all of the retrieved data inside of an object called "response"
    .then(function (response) {
      // Transfer content to HTML
      for (var i = 0; i < 56; i += 8) {
        var weather = $("<div>");
        weather.text(
          "Forecast: " +
          response.list[i].main.temp_max +
          " F and " +
          response.list[i].weather[0].main
        );
        $("#weather-" + [i]).append(weather);
      }
    });

  console.log(new Date().getFullYear());
  console.log(new Date().getMonth());
  console.log(new Date().getDate());

  var day = [
    "Sunday",
    "Monday",
    "Tuesday",
    "Wednesday",
    "Thursday",
    "Friday",
    "Saturday",
    "Sunday",
    "Monday",
    "Tuesday",
    "Wednesday",
    "Thursday",
    "Friday",
    "Saturday"
  ];

  var month = [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"
  ];
  // dynamically add month and year to top of the calendar. auto updates every month.
  $("#month").append(month[new Date().getMonth()]);
  $("#year").append(new Date().getFullYear());

  // sets first calendar column to today then adds one for the next 6 days
  for (var i = 0; i < 7; i++) {
    var date = $("<div>");
    var options = $("<option>");
    date.text(day[new Date().getDay() + i]);
    $("#day" + i).append(date);
  }

  // sets date to first column and adds one for the next 6 days. dropown day also.
  for (var i = 0; i < 7; i++) {
    var month = new Date().getMonth() + 1;
    var day = new Date().getDate();
    var dayPlus = day + i;
    var year = new Date().getFullYear();
    var fullDate = $("<div>");
    var options = $("<option>");
    fullDate.text(month + "-" + dayPlus + "-" + year);
    options.text(month + "-" + dayPlus + "-" + year);
    options.attr({ class: "day", value: i })
    $("#day" + i).append(fullDate);
    $("#dayOptions").append(options);
  }

  $("#submit").on("click", function (event) {
    // Make sure to preventDefault on a submit event.
    event.preventDefault();

    var newCalendar = {
      dates: $(".day").val(),
      app: $("#appointment").val().trim(),
      time: $("#time").val().trim()
    };
    console.log(newCalendar)
    // Send the POST request.
    $.ajax("/api/calendar", {
      type: "POST",
      data: newCalendar
    }).then(
      function () {
        console.log("created new burger");
        // Reload the page to get the updated list
        location.reload()
      }
    );
  });

  function activeDay() {
    var currentDay = new Date().getDate();
    console.log(currentDay)
    // loops through 31 days and selects current day
    for (var i = 0; i < 31; i++) {
      if (i === currentDay) {
        console.log("today is" + i);
        // changes the current day to active
        var selector = ".days li";
        var elems = document.querySelectorAll(selector);
        makeActive = function (day) {
          for (var j = 0; j < elems.length; j++) {
            if (parseInt(elems[j].innerText) === parseInt(currentDay)) {
              console.log(elems[j]);
              elems[j].setAttribute("class", "active");
            }
          }
        };
        makeActive(i);
      }
    }
  }
  activeDay();
</script>

</html>